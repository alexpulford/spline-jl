function ortho(left, right, top, bottom, near, far)
    return GLfloat[2.0/(right-left) 0 0 0
            0 2.0/(top-bottom) 0 0
            0 0 2.0/(far-near) 0
            -(right+left)/(right-left) -(top+bottom)/(top-bottom) -(far+near)/(far-near) 1]
end

function ortho(size, ratio)
    a = size / 2
    b = a * ratio
    return ortho(-a, a, b, -b, -size, size)
end

function rotation(x, y, z)
    xr = GLfloat[1 0 0 0
            0 cos(-x) -sin(-x) 0
            0 sin(-x) cos(-x) 0
            0 0 0 1]
    yr = GLfloat[cos(-y) 0 sin(-y) 0
            0 1 0 0
            -sin(-y) 0 cos(-y) 0
            0 0 0 1]
    zr = GLfloat[cos(-z) -sin(-z) 0 0
            sin(-z) cos(-z) 0 0
            0 0 1 0
            0 0 0 1] 
    return xr*zr*yr 
end

function identity()
        return GLfloat[1 0 0 0
                       0 1 0 0
                       0 0 1 0
                       0 0 0 1]
end

function intersect(p1, p2, rot_m, orth_m, points)
        v = normalize(p2-p1)

        min_d = Inf
        min_p = nothing
        min_i = 0

        i = 0
        for p in points
                i += 1
                t = [p.x, p.y, p.z, 1]
                P = t-p1
                d = sqrt(dot(P,P) - dot(v, P)^2)

                if d < min_d
                        min_d = d
                        min_p = p
                        min_i = i
                end
        end

        return min_d, min_i
end

function generate_gizmo(z, w)
    h = 3*w
    j = z+(6*w)
    return GLfloat[
            z, -w, w, 1, 0, 0, 1, 0, 0,
            -z, -w, w, 1, 0, 0, 1, 0, 0,
            -z, w, w, 1, 0, 0, 1, 0, 0,
            z, -w, w, 1, 0, 0, 1, 0, 0,
            z, w, w, 1, 0, 0, 1, 0, 0,
            -z, w, w, 1, 0, 0, 1, 0, 0,
            z, -w, -w, 0.9, 0, 0, 1, 0, 0,
            -z, -w, -w, 0.9, 0, 0, 1, 0, 0,
            -z, w, -w, 0.9, 0, 0, 1, 0, 0,
            z, -w, -w, 0.9, 0, 0, 1, 0, 0,
            z, w, -w, 0.9, 0, 0, 1, 0, 0,
            -z, w, -w, 0.9, 0, 0, 1, 0, 0,
            z, w, -w, 0.8, 0, 0, 1, 0, 0,
            -z, w, -w, 0.8, 0, 0, 1, 0, 0,
            -z, w, w, 0.8, 0, 0, 1, 0, 0,
            z, w, -w, 0.8, 0, 0, 1, 0, 0,
            z, w, w, 0.8, 0, 0, 1, 0, 0,
            -z, w, w, 0.8, 0, 0, 1, 0, 0,
            z, -w, -w, 0.7, 0, 0, 1, 0, 0,
            -z, -w, -w, 0.7, 0, 0, 1, 0, 0,
            -z, -w, w, 0.7, 0, 0, 1, 0, 0,
            z, -w, -w, 0.7, 0, 0, 1, 0, 0,
            z, -w, w, 0.7, 0, 0, 1, 0, 0,
            -z, -w, w, 0.7, 0, 0, 1, 0, 0,
            z, h, h, 1, 0, 0, 1, 0, 0,
            j, 0, 0, 1, 0, 0, 1, 0, 0,
            z, -h, h, 1, 0, 0, 1, 0, 0,
            z, -h, h, 0.9, 0, 0, 1, 0, 0,
            j, 0, 0, 0.9, 0, 0, 1, 0, 0,
            z, -h, -h, 0.9, 0, 0, 1, 0, 0,
            z, -h, -h, 0.8, 0, 0, 1, 0, 0,
            j, 0, 0, 0.8, 0, 0, 1, 0, 0,
            z, h, -h, 0.8, 0, 0, 1, 0, 0,
            z, h, -h, 0.7, 0, 0, 1, 0, 0,
            j, 0, 0, 0.7, 0, 0, 1, 0, 0,
            z, h, h, 0.7, 0, 0, 1, 0, 0,
            -z, h, h, 1, 0, 0, 1, 0, 0,
            -j, 0, 0, 1, 0, 0, 1, 0, 0,
            -z, -h, h, 1, 0, 0, 1, 0, 0,
            -z, -h, h, 0.9, 0, 0, 1, 0, 0,
            -j, 0, 0, 0.9, 0, 0, 1, 0, 0,
            -z, -h, -h, 0.9, 0, 0, 1, 0, 0,
            -z, -h, -h, 0.8, 0, 0, 1, 0, 0,
            -j, 0, 0, 0.8, 0, 0, 1, 0, 0,
            -z, h, -h, 0.8, 0, 0, 1, 0, 0,
            -z, h, -h, 0.7, 0, 0, 1, 0, 0,
            -j, 0, 0, 0.7, 0, 0, 1, 0, 0,
            -z, h, h, 0.7, 0, 0, 1, 0, 0,

            -w, z, w, 0, 1, 0, 1, 0, 0,
            -w, -z, w, 0, 1, 0, 1, 0, 0,
            w, -z, w, 0, 1, 0, 1, 0, 0,
            -w, z, w, 0, 1, 0, 1, 0, 0,
            w, z, w, 0, 1, 0, 1, 0, 0,
            w, -z, w, 0, 1, 0, 1, 0, 0,
            -w, z, -w, 0, 0.9, 0, 1, 0, 0,
            -w, -z, -w, 0, 0.9, 0, 1, 0, 0,
            w, -z, -w, 0, 0.9, 0, 1, 0, 0,
            -w, z, -w, 0, 0.9, 0, 1, 0, 0,
            w, z, -w, 0, 0.9, 0, 1, 0, 0,
            w, -z, -w, 0, 0.9, 0, 1, 0, 0,
            w, z, -w, 0, 0.8, 0, 1, 0, 0,
            w, -z, -w, 0, 0.8, 0, 1, 0, 0,
            w, -z, w, 0, 0.8, 0, 1, 0, 0,
            w, z, -w, 0, 0.8, 0, 1, 0, 0,
            w, z, w, 0, 0.8, 0, 1, 0, 0,
            w, -z, w, 0, 0.8, 0, 1, 0, 0,
            -w, z, -w, 0, 0.7, 0, 1, 0, 0,
            -w, -z, -w, 0, 0.7, 0, 1, 0, 0,
            -w, -z, w, 0, 0.7, 0, 1, 0, 0,
            -w, z, -w, 0, 0.7, 0, 1, 0, 0,
            -w, z, w, 0, 0.7, 0, 1, 0, 0,
            -w, -z, w, 0, 0.7, 0, 1, 0, 0,
            h, z, h, 0, 1, 0, 1, 0, 0,
            0, j, 0, 0, 1, 0, 1, 0, 0,
            -h, z, h, 0, 1, 0, 1, 0, 0,
            -h, z, h, 0, 0.9, 0, 1, 0, 0,
            0, j, 0, 0, 0.9, 0, 1, 0, 0,
            -h, z, -h, 0, 0.9, 0, 1, 0, 0,
            -h, z, -h, 0, 0.8, 0, 1, 0, 0,
            0, j, 0, 0, 0.8, 0, 1, 0, 0,
            h, z, -h, 0, 0.8, 0, 1, 0, 0,
            h, z, -h, 0, 0.7, 0, 1, 0, 0,
            0, j, 0, 0, 0.7, 0, 1, 0, 0,
            h, z, h, 0, 0.7, 0, 1, 0, 0,
            h, -z, h, 0, 1, 0, 1, 0, 0,
            0, -j, 0, 0, 1, 0, 1, 0, 0,
            -h, -z, h, 0, 1, 0, 1, 0, 0,
            -h, -z, h, 0, 0.9, 0, 1, 0, 0,
            0, -j, 0, 0, 0.9, 0, 1, 0, 0,
            -h, -z, -h, 0, 0.9, 0, 1, 0, 0,
            -h, -z, -h, 0, 0.8, 0, 1, 0, 0,
            0, -j, 0, 0, 0.8, 0, 1, 0, 0,
            h, -z, -h, 0, 0.8, 0, 1, 0, 0,
            h, -z, -h, 0, 0.7, 0, 1, 0, 0,
            0, -j, 0, 0, 0.7, 0, 1, 0, 0,
            h, -z, h, 0, 0.7, 0, 1, 0, 0,

            -w, w, z, 0, 0, 1, 1, 0, 0,
            -w, w, -z, 0, 0, 1, 1, 0, 0,
            w, w, -z, 0, 0, 1, 1, 0, 0,
            -w, w, z, 0, 0, 1, 1, 0, 0,
            w, w, z, 0, 0, 1, 1, 0, 0,
            w, w, -z, 0, 0, 1, 1, 0, 0,
            -w, -w, z, 0, 0, 0.9, 1, 0, 0,
            -w, -w, -z, 0, 0, 0.9, 1, 0, 0,
            w, -w, -z, 0, 0, 0.9, 1, 0, 0,
            -w, -w, z, 0, 0, 0.9, 1, 0, 0,
            w, -w, z, 0, 0, 0.9, 1, 0, 0,
            w, -w, -z, 0, 0, 0.9, 1, 0, 0,
            w, -w, z, 0, 0, 0.8, 1, 0, 0,
            w, -w, -z, 0, 0, 0.8, 1, 0, 0,
            w, w, -z, 0, 0, 0.8, 1, 0, 0,
            w, -w, z, 0, 0, 0.8, 1, 0, 0,
            w, w, z, 0, 0, 0.8, 1, 0, 0,
            w, w, -z, 0, 0, 0.8, 1, 0, 0,
            -w, -w, z, 0, 0, 0.7, 1, 0, 0,
            -w, -w, -z, 0, 0, 0.7, 1, 0, 0,
            -w, w, -z, 0, 0, 0.7, 1, 0, 0,
            -w, -w, z, 0, 0, 0.7, 1, 0, 0,
            -w, w, z, 0, 0, 0.7, 1, 0, 0,
            -w, w, -z, 0, 0, 0.7, 1, 0, 0,
            h, h, z, 0, 0, 1, 1, 0, 0,
            0, 0, j, 0, 0, 1, 1, 0, 0,
            -h, h, z, 0, 0, 1, 1, 0, 0,
            -h, h, z, 0, 0, 0.9, 1, 0, 0,
            0, 0, j, 0, 0, 0.9, 1, 0, 0,
            -h, -h, z, 0, 0, 0.9, 1, 0, 0,
            -h, -h, z, 0, 0, 0.8, 1, 0, 0,
            0, 0, j, 0, 0, 0.8, 1, 0, 0,
            h, -h, z, 0, 0, 0.8, 1, 0, 0,
            h, -h, z, 0, 0, 0.7, 1, 0, 0,
            0, 0, j, 0, 0, 0.7, 1, 0, 0,
            h, h, z, 0, 0, 0.7, 1, 0, 0,
            h, h, -z, 0, 0, 1, 1, 0, 0,
            0, 0, -j, 0, 0, 1, 1, 0, 0,
            -h, h, -z, 0, 0, 1, 1, 0, 0,
            -h, h, -z, 0, 0, 0.9, 1, 0, 0,
            0, 0, -j, 0, 0, 0.9, 1, 0, 0,
            -h, -h, -z, 0, 0, 0.9, 1, 0, 0,
            -h, -h, -z, 0, 0, 0.8, 1, 0, 0,
            0, 0, -j, 0, 0, 0.8, 1, 0, 0,
            h, -h, -z, 0, 0, 0.8, 1, 0, 0,
            h, -h, -z, 0, 0, 0.7, 1, 0, 0,
            0, 0, -j, 0, 0, 0.7, 1, 0, 0,
            h, h, -z, 0, 0, 0.7, 1, 0, 0,
]
end